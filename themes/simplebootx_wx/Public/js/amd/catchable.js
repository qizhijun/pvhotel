//! catchable.js
!function(t){t.extend(t.fn,{catchable:function(c){var i=function(){},e={alternating:!1,container:window,threshold:"0 0",catched:i,lost:i};return t._catchnumber=t._catchnumber||0,this.each(function(){var i=this,h=t.extend({},c||{});t.each(h,function(c,e){return{catched:1,lost:1}[c]?!0:void(h[c]=t.isFunction(e)?e.call(i):e)}),h=t.extend(e,h);{var n=t(h.container),a=n.size()?n[0]:window;t(a)}this._catch_options=h,this._catchabled=!0,t._catchnumber++,this._catch_container=a,a._catch_items=a._catch_items||[],-1==t(a._catch_items).index(this)&&a._catch_items.push(this),t(this).addClass("catchable_"+t._catchnumber).bind("snap",function(){var c=this._catch_options,i=this;if("hidden"!=t(this).css("visibility")&&"none"!=t(this).css("display")&&this._catchabled){var e=t.extend({width:t(this).width(),height:t(this).height()},t(this).offset()),h=this._catch_container;h._catch_box=function(){var c=h===window?{left:t(h).scrollLeft(),top:t(h).scrollTop()}:t(h).offset();return{left:c.left,top:c.top,width:t(h).width(),height:t(h).height()}}();var n=h._catch_box,a=t.map(c.threshold.split(/\s*?[\s\,]\s*?/gi),function(t,c){return/[\d\.]%/.test(t)?e[["width","height"][c]]*parseInt(t)/100:parseInt(t)}),s={x:a[0]||0,y:a[1]||0},o=e.left+e.width-n.left,r=n.left+n.width-e.left,d=e.top+e.height-n.top,_=n.top+n.height-e.top;i._catch_visible=!0,o>s.x&&r>s.x&&d>s.y&&_>s.y?(i._catch_visible=!0,c.alternating&&i._catched||t(i).trigger("catched")):(i._catch_visible=!1,(!c.alternating||i._catched)&&t(i).trigger("catchlost"))}}).bind("catched",function(){var c=this._catch_options.catched;t.isFunction(c)&&c.call(this),this._catched=!0}).bind("catchlost",function(){var c=this._catch_options.lost;t.isFunction(c)&&c.call(this),this._catched=!1})})},catchOptions:function(c){return c=c||{},this.each(function(){var i=this,e=this._catch_options;t.each(c,function(c,h){switch(c){case"container":var n=t(h);i._catch_container=n.size()?n[0]:window;break;case"catched":case"lost":e[c]=h;break;default:e[c]=t.isFunction(h)?h.call(i):h}})})},discatch:function(){return this.each(function(){this._catchabled=null;var c=this,i=this._catch_container;t(this).unbind("snap catched catchlost"),i&&(i._catch_items=t.grep(i._catch_items,function(t){return t!=c}))})},snapit:function(){return this.each(function(){this._catchabled&&t(this).trigger("snap"),this._catch_items&&t.each(this._catch_items,function(){this&&t(this).trigger("snap")})})},defer:function(c,i,e){return i=i||"defer",e=e||5e3,this.each(function(){if(t(this).is("img")&&!this._catchabled&&!this._defered){var h=!!t(this).attr(i);h&&(this._defered=!0,t(this).catchable({catched:function(){function h(){clearTimeout(s),t.isFunction(c)&&0==c.call(n,a)||t(n).css("opacity",.8).attr("src",a).animate({opacity:1},500)}var n=this,a=this.getAttribute(i),s=setTimeout(h,e),o=new Image;o.onload=h,o.src=a,t(this).discatch()}}))}})}}),"function"==typeof define&&define.amd&&define("catchable",[t.jquery?"jquery":"zepto"],function(){})}(window.jQuery||window.Zepto);